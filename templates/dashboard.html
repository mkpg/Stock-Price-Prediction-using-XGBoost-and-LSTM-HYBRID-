<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‚Äî QuantumTrade Pro</title>
    <meta name="description" content="Advanced stock prediction dashboard with LSTM + XGBoost ensemble analysis.">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>

<body>
    <div class="bg-grid"></div>
    <div class="bg-glow"></div>

    <!-- Navigation -->
    <nav class="navbar-pro">
        <a href="/" class="logo">
            <div class="logo-icon">‚ö°</div>
            <span>QuantumTrade<span style="color: var(--accent-cyan); font-weight: 400;">PRO</span></span>
        </a>
        <ul class="nav-links">
            <li><a href="/">Predict</a></li>
            <li><a href="/analytics">Analytics</a></li>
            <li><a href="/portfolio">Portfolio</a></li>
            <li><a href="/history">History</a></li>
        </ul>
        <div class="nav-actions">
            <button class="theme-btn" id="themeToggle" title="Toggle theme">
                <i class="bi bi-moon-stars-fill"></i>
            </button>
        </div>
    </nav>

    <main class="main-wrapper">
        <div class="container-pro section-spacing">
            <!-- Dashboard Header -->
            <div class="section-header">
                <h1><i class="bi bi-speedometer2" style="color: var(--accent-cyan);"></i> Prediction Dashboard</h1>
                <p>Enter a stock ticker to generate AI-powered predictions</p>
            </div>
            <div class="section-divider"></div>

            <!-- Prediction Form -->
            <div class="predict-card" id="predictCard">
                <h2><i class="bi bi-search" style="color: var(--accent-cyan);"></i> Stock Analysis</h2>
                <form id="predictionForm" method="POST" action="/predict" class="predict-form">
                    <input type="text" id="tickerInput" name="ticker" class="predict-input"
                        placeholder="Enter ticker symbol (e.g. AAPL)" maxlength="5" autocomplete="off" required>
                    <button class="predict-btn" type="submit" id="predictBtn">
                        <i class="bi bi-play-circle-fill"></i>
                        PREDICT
                    </button>
                </form>
                <div class="ticker-chips">
                    <span class="ticker-chip" onclick="setTicker('AAPL')">AAPL</span>
                    <span class="ticker-chip" onclick="setTicker('MSFT')">MSFT</span>
                    <span class="ticker-chip" onclick="setTicker('TSLA')">TSLA</span>
                    <span class="ticker-chip" onclick="setTicker('NVDA')">NVDA</span>
                    <span class="ticker-chip" onclick="setTicker('SPY')">SPY</span>
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading-overlay" id="loadingState">
                <div class="loading-spinner"></div>
                <div class="loading-text">Analyzing <span id="loadingTicker"
                        style="color: var(--accent-cyan); font-family: var(--font-mono);">...</span></div>
                <div class="loading-subtext">Training LSTM & XGBoost models ‚Ä¢ Computing 35+ technical indicators</div>
                <div class="loading-progress">
                    <div class="loading-progress-bar"></div>
                </div>
            </div>

            <!-- Error Alert -->
            {% if error %}
            <div class="alert-pro error">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <span class="alert-text">{{ error }}</span>
            </div>
            {% endif %}

            <!-- Results -->
            {% if ticker %}
            <div class="results-header animate-in">
                <h2><span class="ticker-badge">{{ ticker }}</span> ‚Äî Analysis Complete</h2>
                <a href="/dashboard" class="btn-outline"><i class="bi bi-arrow-clockwise"></i> New Search</a>
            </div>

            <!-- Signal & Accuracy -->
            <div class="kpi-grid animate-in">
                <div class="kpi-card signal-{{ signal_class }}">
                    <span class="kpi-icon">{% if 'BUY' in signal %}üìà{% elif 'SELL' in signal %}üìâ{% else %}‚è∏{% endif
                        %}</span>
                    <div class="kpi-label">Signal</div>
                    <div
                        class="kpi-value {% if 'BUY' in signal %}text-green{% elif 'SELL' in signal %}text-red{% else %}text-gold{% endif %}">
                        {{ signal }}</div>
                    <div class="kpi-subtitle">{{ confidence }} confidence</div>
                </div>

                <div class="kpi-card accent-blue">
                    <span class="kpi-icon">üéØ</span>
                    <div class="kpi-label">Accuracy</div>
                    <div class="kpi-value text-cyan">{{ directional_accuracy }}%</div>
                    <div class="kpi-subtitle">Directional</div>
                </div>

                <div class="kpi-card accent-green">
                    <span class="kpi-icon">üìä</span>
                    <div class="kpi-label">MAPE</div>
                    <div class="kpi-value text-purple">{{ mape }}%</div>
                    <div class="kpi-subtitle">Error rate</div>
                </div>

                <div class="kpi-card accent-gold">
                    <span class="kpi-icon">üß†</span>
                    <div class="kpi-label">R¬≤</div>
                    <div class="kpi-value text-gold">{{ r2 }}</div>
                    <div class="kpi-subtitle">Model fit</div>
                </div>
            </div>

            <!-- Metrics -->
            <div class="metrics-grid animate-in">
                <div class="metric-tile">
                    <div class="label">MSE</div>
                    <div class="value">{{ mse }}</div>
                </div>
                <div class="metric-tile">
                    <div class="label">MAE</div>
                    <div class="value">{{ mae }}</div>
                </div>
                <div class="metric-tile">
                    <div class="label">RMSE</div>
                    <div class="value">{{ rmse }}</div>
                </div>
                <div class="metric-tile">
                    <div class="label">LSTM</div>
                    <div class="value" style="color: var(--accent-green);">{{ lstm_accuracy }}%</div>
                    <div class="hint">Weight: {{ lstm_weight }}%</div>
                </div>
                <div class="metric-tile">
                    <div class="label">XGBoost</div>
                    <div class="value" style="color: var(--accent-red);">{{ xgb_accuracy }}%</div>
                    <div class="hint">Weight: {{ xgb_weight }}%</div>
                </div>
                <div class="metric-tile">
                    <div class="label">Features</div>
                    <div class="value" style="color: var(--accent-purple);">{{ num_features }}</div>
                </div>
            </div>

            <!-- Chart -->
            <div class="chart-card animate-in">
                <div class="chart-header">
                    <h3><i class="bi bi-graph-up" style="color: var(--accent-cyan);"></i> {{ ticker }} ‚Äî AI Forecast
                    </h3>
                    <span style="color: var(--text-muted); font-size: 0.8rem;">{{ now }}</span>
                </div>
                <div class="chart-body">
                    {{ graph_html | safe }}
                </div>
            </div>
            {% endif %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer-pro">
        <div class="container-pro footer-content">
            <div class="footer-brand">‚ö° <span>QuantumTrade PRO</span></div>
            <div class="footer-text">Industrial-grade AI Stock Prediction ‚Ä¢ ¬© 2026</div>
        </div>
    </footer>

    <script>
        function setTicker(t) {
            document.getElementById('tickerInput').value = t;
            document.getElementById('tickerInput').focus();
        }

        document.getElementById('predictionForm').addEventListener('submit', function (e) {
            const ticker = document.getElementById('tickerInput').value.toUpperCase().trim();
            if (!ticker) { e.preventDefault(); return; }
            document.getElementById('loadingTicker').textContent = ticker;
            document.getElementById('loadingState').classList.add('active');
            document.getElementById('predictCard').style.display = 'none';
            const btn = document.getElementById('predictBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-hourglass-split"></i> PROCESSING...';
        });

        document.getElementById('tickerInput').addEventListener('input', function () {
            this.value = this.value.toUpperCase();
        });
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>